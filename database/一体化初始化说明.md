# 一体化初始化工具使用说明

## 工具说明

`AllInOneInitializer.java` 是一个一体化工具，整合了所有初始化流程，只需运行一次即可完成所有操作。

## 功能

该工具会自动执行以下4个步骤：

1. **抓取网页内容** - 从参考网站抓取所有页面的内容和图片URL
2. **修复图片URL** - 自动修复URL拼接错误
3. **下载图片** - 修复图片路径并下载所有图片
4. **初始化数据库** - 清除旧数据并执行SQL脚本

## 使用方法

### 方法1：在IDE中运行

1. 打开 `backend/src/main/java/com/zht/util/AllInOneInitializer.java`
2. 右键点击 `main` 方法
3. 选择 "Run 'AllInOneInitializer.main()'"

### 方法2：使用命令行运行

```bash
cd backend
mvn compile
mvn exec:java -Dexec.mainClass="com.zht.util.AllInOneInitializer"
```

### 方法3：直接运行编译后的类

```bash
cd backend/target/classes
java -cp ".;path/to/jsoup-1.17.2.jar" com.zht.util.AllInOneInitializer
```

## 执行流程

运行后会看到以下输出：

```
========================================
   一体化初始化工具 - 开始执行
========================================

【步骤1/4】抓取网页内容和图片URL...
  抓取: 首页 (http://www.ltt-lab.com.cn/)
  抓取: 关于我们 (http://www.zht-lab.cn/Aboutus.aspx?ClassID=2)
  ...
✓ 抓取完成，共发现 X 张图片

【步骤2/4】修复图片URL...
  修复了 X 个错误URL
  最终URL数量: X
✓ URL修复完成

【步骤3/4】修复图片路径并下载图片...
  修复图片路径...
  删除旧图片...
  已删除 X 个旧图片文件
  开始下载图片...
  下载成功: X, 失败: X
✓ 图片下载完成

【步骤4/4】初始化数据库...
  清除旧数据...
  ✓ 旧数据已清除（admin用户已保留）
  执行SQL脚本...
  执行成功: X 个文件, 跳过: X 个文件
✓ 数据库初始化完成

========================================
   所有流程执行完成！
========================================
```

## 配置说明

如果需要修改配置，请编辑 `AllInOneInitializer.java` 中的以下常量：

```java
// 数据库配置
private static final String DATABASE_URL = "jdbc:mysql://localhost:3306/zht_lab?...";
private static final String DATABASE_USERNAME = "root";
private static final String DATABASE_PASSWORD = "your_password";

// 文件路径
private static final String BASE_PATH = "D:/workspace/pan/";
```

## 注意事项

1. **网络连接**：需要能够访问参考网站
2. **数据库连接**：确保MySQL服务正在运行
3. **文件权限**：确保有写入权限
4. **依赖库**：需要 Jsoup 库（已在 pom.xml 中配置）

## 错误处理

- 如果某个步骤失败，工具会继续执行后续步骤
- 错误信息会输出到控制台
- 可以查看生成的SQL文件和图片列表文件来检查结果

## 生成的文件

执行后会生成以下文件：

- `database/home_data.sql` - 首页数据
- `database/about_data.sql` - 关于我们数据
- `database/laboratory_data.sql` - 实验室数据
- `database/honor_data.sql` - 荣誉资质数据
- `database/news_data.sql` - 新闻数据
- `database/contact_data.sql` - 联系我们数据
- `database/images_to_download.txt` - 图片下载列表

## 后续操作

执行完成后：

1. 检查数据库中的数据是否正确
2. 检查图片是否下载成功
3. 如果SQL文件为空，可以在后台管理系统中手动添加内容
4. 前端页面会根据数据库中的数据自动显示

## 常见问题

**Q: 执行失败怎么办？**
A: 检查网络连接、数据库连接和文件权限

**Q: SQL文件为空？**
A: 可能是CSS选择器不匹配，可以在后台管理系统中手动添加内容

**Q: 图片下载失败？**
A: 检查网络连接和图片URL是否正确

