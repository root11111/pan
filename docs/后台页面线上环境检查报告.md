# 后台页面线上环境检查报告

## 检查时间
2025-12-31

## 检查范围
所有后台管理页面（`frontend/src/views/admin/`）

## 检查结果

### ✅ 已修复的页面（9个）

这些页面之前使用了硬编码的 `http://localhost:8082/api`，现已修复为环境判断：

1. **Honor.vue** (荣誉资质管理)
   - ✅ API baseURL: 已修复
   - ✅ 上传URL: 已修复

2. **Certification.vue** (认证服务管理)
   - ✅ API baseURL: 已修复
   - ✅ 上传URL: 已修复
   - ✅ 导入URL: 已修复
   - ✅ 模板下载URL: 已修复

3. **CertificationCategory.vue** (认证分类管理)
   - ✅ API baseURL: 已修复

4. **Certificate.vue** (证书管理)
   - ✅ API baseURL: 已修复
   - ✅ 上传URL: 已修复

5. **EnterpriseAdvantage.vue** (企业优势管理)
   - ✅ API baseURL: 已修复
   - ✅ 上传URL: 已修复

6. **HomeConfig.vue** (首页配置管理)
   - ✅ API baseURL: 已修复

7. **CorporateCulture.vue** (企业文化管理)
   - ✅ API baseURL: 已修复

8. **MenuConfig.vue** (菜单配置管理)
   - ✅ API baseURL: 已修复

9. **image.js** (图片工具)
   - ✅ API_BASE_URL: 已修复

### ✅ 无需修复的页面（7个）

这些页面使用统一的 API 实例或相对路径，线上环境正常：

1. **Dashboard.vue** (仪表盘)
   - ✅ 无API调用，仅静态展示

2. **Company.vue** (公司信息管理)
   - ✅ 使用统一API: `getCompanyInfo`, `updateCompanyInfo`
   - ✅ 上传URL: `/api/file/upload` (相对路径)

3. **Laboratory.vue** (实验室管理)
   - ✅ 使用统一API: `getLaboratories`, `saveLaboratory`, `deleteLaboratory`
   - ✅ 上传URL: `/api/file/upload` (相对路径)

4. **Login.vue** (登录页面)
   - ✅ 使用统一API: `adminLogin`

5. **News.vue** (新闻管理)
   - ✅ 使用统一API: `getNewsPage`, `saveNews`, `deleteNews`
   - ✅ 上传URL: `/api/file/upload` (相对路径)
   - ✅ 批量删除: 使用统一API实例

6. **Message.vue** (留言管理)
   - ✅ 使用统一API: `getMessagePage`, `updateMessageStatus`, `deleteMessage`

7. **Chat.vue** (实时聊天)
   - ✅ WebSocket连接: `/ws` (相对路径)
   - ⚠️ **注意**: 需要确认 Nginx 是否配置了 WebSocket 代理

## 统一API配置

所有页面使用的统一API实例配置（`frontend/src/api/index.js`）：
```javascript
const api = axios.create({
  baseURL: '/api',  // ✅ 相对路径，线上环境正常
  timeout: 10000
})
```

## 需要确认的配置

### 1. Nginx WebSocket 代理

`Chat.vue` 使用 WebSocket 连接 `/ws`，需要确认 Nginx 配置中是否包含 WebSocket 代理：

```nginx
location /ws {
    proxy_pass http://127.0.0.1:8082;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    
    proxy_connect_timeout 60s;
    proxy_send_timeout 60s;
    proxy_read_timeout 60s;
}
```

### 2. 文件上传路径

所有文件上传都使用 `/api/file/upload`，需要确认：
- ✅ Nginx 已配置 `/api/` 代理到后端
- ✅ 后端服务正常运行在 8082 端口

## 修复说明

### 修复方式

所有硬编码的 `http://localhost:8082/api` 已改为环境判断：

```javascript
// 修复前
baseURL: import.meta.env.VITE_API_BASE_URL || 'http://localhost:8082/api'

// 修复后
baseURL: import.meta.env.VITE_API_BASE_URL || (import.meta.env.DEV ? 'http://localhost:8082/api' : '/api')
```

### 工作原理

- **开发环境** (`npm run dev`): `import.meta.env.DEV === true` → 使用 `http://localhost:8082/api`
- **生产环境** (`npm run build`): `import.meta.env.DEV === false` → 使用 `/api` (相对路径)

## 部署检查清单

在重新构建和部署前，请确认：

- [x] 所有硬编码的 localhost:8082 已修复
- [ ] Nginx 配置了 `/api/` 代理到后端
- [ ] Nginx 配置了 `/ws` WebSocket 代理（如果使用聊天功能）
- [ ] 后端服务在 8082 端口正常运行
- [ ] 重新构建前端项目 (`npm run build`)
- [ ] 上传 `dist` 目录到服务器
- [ ] 清除浏览器缓存测试

## 测试建议

部署后，建议测试以下功能：

1. ✅ 登录功能 (`/admin/login`)
2. ✅ 荣誉资质管理 (`/admin/honor`)
3. ✅ 认证服务管理 (`/admin/certification`)
4. ✅ 认证分类管理 (`/admin/certification-category`)
5. ✅ 证书管理 (`/admin/certificate`)
6. ✅ 企业优势管理 (`/admin/advantage`)
7. ✅ 首页配置 (`/admin/home-config`)
8. ✅ 企业文化管理 (`/admin/corporate-culture`)
9. ✅ 菜单配置 (`/admin/menu-config`)
10. ✅ 公司信息管理 (`/admin/company`)
11. ✅ 实验室管理 (`/admin/laboratory`)
12. ✅ 新闻管理 (`/admin/news`)
13. ✅ 留言管理 (`/admin/message`)
14. ⚠️ 实时聊天 (`/admin/chat`) - 需要 WebSocket 支持

## 总结

✅ **所有后台页面已检查完毕，硬编码的 API 地址已全部修复。**

线上环境应该可以正常访问所有后台管理功能。唯一需要注意的是 WebSocket 功能（聊天），需要确认 Nginx 是否配置了 WebSocket 代理。

