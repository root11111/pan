# 解决 403 Forbidden 错误

## 快速排查步骤

### 1. 检查文件是否存在

在宝塔面板中：
- 进入 `文件` → 打开 `/www/wwwroot/tht-lab.com.cn/`
- 确认 `index.html` 文件存在

或者使用 SSH：
```bash
ls -la /www/wwwroot/tht-lab.com.cn/
ls -la /www/wwwroot/tht-lab.com.cn/index.html
```

### 2. 检查文件权限

在宝塔面板中：
- 进入 `文件` → 选择 `/www/wwwroot/tht-lab.com.cn/` 目录
- 点击 `权限` → 设置为：
  - 所有者：`www`
  - 权限：`755`（目录）或 `644`（文件）

或者使用 SSH：
```bash
# 设置目录权限
chown -R www:www /www/wwwroot/tht-lab.com.cn
chmod -R 755 /www/wwwroot/tht-lab.com.cn

# 设置文件权限
find /www/wwwroot/tht-lab.com.cn -type f -exec chmod 644 {} \;
find /www/wwwroot/tht-lab.com.cn -type d -exec chmod 755 {} \;
```

### 3. 检查 Nginx 配置

确认 Nginx 配置中的以下设置：

1. **root 路径正确**：
   ```nginx
   root /www/wwwroot/tht-lab.com.cn;
   ```

2. **index 文件存在**：
   ```nginx
   index index.html index.htm;
   ```

3. **没有禁止访问的规则**：
   检查是否有 `deny all;` 或类似的禁止规则

### 4. 检查 Nginx 错误日志

在宝塔面板中：
- `网站` → `tht-lab.com.cn` → `设置` → `日志`
- 查看错误日志：`/www/wwwlogs/tht-lab.com.cn.error.log`

或者使用 SSH：
```bash
tail -n 50 /www/wwwlogs/tht-lab.com.cn.error.log
```

### 5. 检查 SELinux（如果启用）

如果服务器启用了 SELinux，可能需要设置：

```bash
# 检查 SELinux 状态
getenforce

# 如果显示 Enforcing，需要设置上下文
chcon -R -t httpd_sys_content_t /www/wwwroot/tht-lab.com.cn/
```

---

## 完整修复步骤

### 步骤 1：检查并修复文件权限

```bash
# 进入网站目录
cd /www/wwwroot/tht-lab.com.cn

# 检查文件是否存在
ls -la

# 如果文件存在，修复权限
chown -R www:www /www/wwwroot/tht-lab.com.cn
chmod 755 /www/wwwroot/tht-lab.com.cn
find /www/wwwroot/tht-lab.com.cn -type f -exec chmod 644 {} \;
find /www/wwwroot/tht-lab.com.cn -type d -exec chmod 755 {} \;
```

### 步骤 2：检查 Nginx 配置

在宝塔面板中检查配置文件，确保：

1. **root 路径正确且目录存在**
2. **index 文件配置正确**
3. **没有禁止访问的 location 规则**

### 步骤 3：测试 Nginx 配置

```bash
# 测试 Nginx 配置语法
nginx -t

# 如果配置正确，重启 Nginx
/etc/init.d/nginx reload
```

### 步骤 4：检查目录索引

如果 `index.html` 不存在，需要：

1. 确认前端文件已正确上传
2. 检查 `dist` 目录中的 `index.html` 是否上传到了正确位置

---

## 常见原因和解决方案

### 原因 1：文件权限不足

**解决方案：**
```bash
chown -R www:www /www/wwwroot/tht-lab.com.cn
chmod -R 755 /www/wwwroot/tht-lab.com.cn
```

### 原因 2：index.html 文件不存在

**解决方案：**
- 确认前端已构建：`cd frontend && npm run build`
- 确认 `dist` 目录中的文件已上传到 `/www/wwwroot/tht-lab.com.cn/`
- 确认 `index.html` 在根目录下

### 原因 3：Nginx 配置错误

**解决方案：**
检查并确保配置中有：
```nginx
root /www/wwwroot/tht-lab.com.cn;
index index.html;
location / {
    try_files $uri $uri/ /index.html;
}
```

### 原因 4：目录不存在

**解决方案：**
```bash
# 创建目录（如果不存在）
mkdir -p /www/wwwroot/tht-lab.com.cn
chown -R www:www /www/wwwroot/tht-lab.com.cn
chmod 755 /www/wwwroot/tht-lab.com.cn
```

### 原因 5：Nginx 用户权限问题

**解决方案：**
检查 Nginx 运行用户（通常是 `www`）是否有权限访问目录：
```bash
# 检查 Nginx 运行用户
ps aux | grep nginx

# 确保目录所有者是 www
chown -R www:www /www/wwwroot/tht-lab.com.cn
```

---

## 快速修复脚本

创建一个修复脚本 `/root/fix-403.sh`：

```bash
#!/bin/bash

# 设置网站目录
SITE_DIR="/www/wwwroot/tht-lab.com.cn"

echo "开始修复 403 错误..."

# 1. 检查目录是否存在
if [ ! -d "$SITE_DIR" ]; then
    echo "目录不存在，创建目录..."
    mkdir -p "$SITE_DIR"
fi

# 2. 修复文件权限
echo "修复文件权限..."
chown -R www:www "$SITE_DIR"
chmod 755 "$SITE_DIR"
find "$SITE_DIR" -type f -exec chmod 644 {} \;
find "$SITE_DIR" -type d -exec chmod 755 {} \;

# 3. 检查 index.html
if [ ! -f "$SITE_DIR/index.html" ]; then
    echo "警告: index.html 文件不存在！"
    echo "请确认前端文件已正确上传。"
else
    echo "index.html 文件存在。"
fi

# 4. 测试 Nginx 配置
echo "测试 Nginx 配置..."
nginx -t

# 5. 重启 Nginx
if [ $? -eq 0 ]; then
    echo "重启 Nginx..."
    /etc/init.d/nginx reload
    echo "修复完成！"
else
    echo "Nginx 配置有错误，请检查配置文件。"
fi
```

赋予执行权限并运行：
```bash
chmod +x /root/fix-403.sh
/root/fix-403.sh
```

---

## 验证修复

修复后，访问网站：
```bash
# 测试本地访问
curl -I http://localhost/

# 测试域名访问
curl -I https://tht-lab.com.cn/
```

如果返回 200 状态码，说明修复成功。

---

## 如果仍然无法解决

1. **查看详细错误日志**：
   ```bash
   tail -f /www/wwwlogs/tht-lab.com.cn.error.log
   ```

2. **检查 Nginx 主配置**：
   ```bash
   cat /etc/nginx/nginx.conf
   ```

3. **检查是否有其他限制**：
   - 防火墙规则
   - 宝塔面板的安全设置
   - 服务器的安全策略

4. **联系技术支持**，提供以下信息：
   - 错误日志内容
   - Nginx 配置内容
   - 文件权限信息（`ls -la /www/wwwroot/tht-lab.com.cn/`）

