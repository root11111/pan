# 修复 403 目录索引错误

## 问题分析

错误信息：`directory index of "/www/wwwroot/tht-lab.com.cn/" is forbidden`

**原因：** Nginx 找不到 `index.html` 文件，导致无法显示首页。

---

## 立即修复步骤

### 步骤 1：检查文件是否存在

在宝塔面板中：
1. 进入 `文件` → 打开 `/www/wwwroot/tht-lab.com.cn/`
2. **确认 `index.html` 文件是否存在**

如果不存在，说明前端文件没有正确上传。

### 步骤 2：上传前端文件

**在本地执行：**
```bash
cd frontend
npm run build
```

**然后上传文件：**
- 将 `frontend/dist` 目录下的**所有文件**上传到 `/www/wwwroot/tht-lab.com.cn/`
- 确保 `index.html` 在根目录下

### 步骤 3：检查 Nginx 配置

在宝塔面板中：
1. `网站` → `tht-lab.com.cn` → `设置` → `配置文件`
2. 确保配置中有：
   ```nginx
   index index.html index.htm;
   root /www/wwwroot/tht-lab.com.cn;
   ```

### 步骤 4：修复文件权限

在宝塔面板中：
1. 选择 `/www/wwwroot/tht-lab.com.cn/` 目录
2. 点击 `权限`
3. 设置为：
   - 所有者：`www`
   - 权限：`755`

或使用 SSH：
```bash
chown -R www:www /www/wwwroot/tht-lab.com.cn
chmod 755 /www/wwwroot/tht-lab.com.cn
find /www/wwwroot/tht-lab.com.cn -type f -exec chmod 644 {} \;
```

### 步骤 5：重启 Nginx

在宝塔面板中：
- `软件商店` → `Nginx` → `设置` → `重启`

---

## 完整检查清单

### ✅ 1. 文件检查

```bash
# 检查目录是否存在
ls -la /www/wwwroot/tht-lab.com.cn/

# 检查 index.html 是否存在
ls -la /www/wwwroot/tht-lab.com.cn/index.html

# 检查文件列表
ls -la /www/wwwroot/tht-lab.com.cn/ | head -20
```

**应该看到：**
- `index.html` 文件
- `assets` 目录（包含 JS 和 CSS 文件）
- 其他静态资源文件

### ✅ 2. 权限检查

```bash
# 检查目录权限
ls -ld /www/wwwroot/tht-lab.com.cn/

# 应该显示：drwxr-xr-x www www
```

### ✅ 3. Nginx 配置检查

确保配置文件中包含：

```nginx
server {
    listen 80;
    listen 443 ssl http2;
    server_name tht-lab.com.cn;
    
    # 重要：必须设置 index
    index index.html index.htm;
    
    # 重要：必须设置 root
    root /www/wwwroot/tht-lab.com.cn;
    
    # 前端路由支持
    location / {
        try_files $uri $uri/ /index.html;
    }
    
    # ... 其他配置
}
```

---

## 如果 index.html 不存在

### 方案 1：重新上传前端文件

1. **本地构建：**
   ```bash
   cd frontend
   npm install  # 如果还没安装依赖
   npm run build
   ```

2. **检查构建结果：**
   ```bash
   ls -la frontend/dist/
   # 应该看到 index.html
   ```

3. **上传文件：**
   - 使用宝塔面板的文件管理器
   - 或使用 FTP/SFTP
   - 将 `frontend/dist/` 下的**所有内容**上传到 `/www/wwwroot/tht-lab.com.cn/`

4. **确认上传结果：**
   ```bash
   ls -la /www/wwwroot/tht-lab.com.cn/index.html
   ```

### 方案 2：使用命令行上传（如果有 SSH 访问）

```bash
# 在本地（开发机器）
cd frontend
npm run build
tar czf dist.tar.gz dist/

# 上传到服务器（使用 scp）
scp dist.tar.gz root@your-server-ip:/tmp/

# 在服务器上解压
ssh root@your-server-ip
cd /tmp
tar xzf dist.tar.gz
cp -r dist/* /www/wwwroot/tht-lab.com.cn/
chown -R www:www /www/wwwroot/tht-lab.com.cn
chmod -R 755 /www/wwwroot/tht-lab.com.cn
```

---

## 验证修复

修复后，执行以下检查：

### 1. 检查文件
```bash
ls -la /www/wwwroot/tht-lab.com.cn/index.html
```

### 2. 测试访问
```bash
curl -I http://localhost/
# 应该返回 200 OK
```

### 3. 访问网站
在浏览器中访问：`https://tht-lab.com.cn/`

应该能看到网站首页，而不是 403 错误。

---

## 常见问题

### Q: 为什么会出现这个错误？

A: 因为 Nginx 找不到 `index.html` 文件。可能的原因：
- 前端文件没有上传
- 上传到了错误的目录
- 文件权限不正确

### Q: 如何确认文件已正确上传？

A: 在宝塔面板中：
1. 进入 `文件` → `/www/wwwroot/tht-lab.com.cn/`
2. 应该能看到：
   - `index.html`
   - `assets/` 目录
   - 其他静态文件

### Q: 上传后还是 403？

A: 检查：
1. 文件权限是否正确（所有者应该是 `www`）
2. Nginx 配置中的 `root` 路径是否正确
3. Nginx 配置中的 `index` 指令是否存在
4. 重启 Nginx

---

## 快速修复脚本

如果可以使用 SSH，执行以下脚本：

```bash
#!/bin/bash

SITE_DIR="/www/wwwroot/tht-lab.com.cn"

echo "检查文件..."
if [ ! -f "$SITE_DIR/index.html" ]; then
    echo "错误: index.html 不存在！"
    echo "请先上传前端文件到 $SITE_DIR"
    exit 1
fi

echo "修复权限..."
chown -R www:www "$SITE_DIR"
chmod 755 "$SITE_DIR"
find "$SITE_DIR" -type f -exec chmod 644 {} \;
find "$SITE_DIR" -type d -exec chmod 755 {} \;

echo "测试 Nginx 配置..."
nginx -t

if [ $? -eq 0 ]; then
    echo "重启 Nginx..."
    /etc/init.d/nginx reload
    echo "修复完成！"
else
    echo "Nginx 配置有错误，请检查配置文件。"
fi
```

保存为 `/root/fix-403.sh`，然后执行：
```bash
chmod +x /root/fix-403.sh
/root/fix-403.sh
```

